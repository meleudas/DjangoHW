{% extends 'main/base.html' %}
{% load shop_filters shop_tags %}
{% load static tailwind_tags %}

{% block title %}
    {% if search_query %}Пошук: {{ search_query }}{% elif category %}{{ category.name }}{% else %}Каталог товарів{% endif %}
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <!-- Заголовок секції -->
    <div class="mb-10 text-center">
        <h1 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-blue-600 to-indigo-800 bg-clip-text text-transparent mb-3">
            {% if search_query %}
                Результати пошуку: "{{ search_query }}"
            {% elif category %}
                {{ category.name }}
            {% else %}
                Каталог товарів
            {% endif %}
        </h1>
        <p class="text-gray-600 max-w-2xl mx-auto">
            {% if search_query %}
                Знайдено {{ products.paginator.count }} товарів за вашим запитом
            {% elif category %}
                Перегляньте всі товари в категорії "{{ category.name }}"
            {% else %}
                Найкращі товари для вас з доставкою по всій Україні
            {% endif %}
        </p>
    </div>

    <!-- Популярні товари -->
    <div class="mb-12">
        {% show_popular_products 3 %}
    </div>

    <!-- Фільтри та інструменти -->
    <div class="bg-white rounded-2xl shadow-md p-4 md:p-6 mb-8 border border-gray-100">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <!-- Лічильник товарів -->
            <div class="flex items-center space-x-2">
                <div class="bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1.5 rounded-full">
                    Усього: {% get_products_count %}
                </div>
                {% if category %}
                    <div class="bg-green-100 text-green-800 text-sm font-medium px-3 py-1.5 rounded-full">
                        У категорії: {% get_products_count category %}
                    </div>
                {% endif %}
            </div>

            <!-- Форма пошуку (мобільна версія) -->
            <div class="md:hidden w-full">
                {% include 'main/search_form.html' %}
            </div>

            <!-- Сортування -->
            <div class="flex flex-wrap items-center gap-2">
                <span class="font-medium text-gray-700 hidden md:inline-block">Сортувати:</span>
                <div class="flex flex-wrap gap-2">
                    <a href="?sort=new{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" 
                       class="px-3 py-1.5 rounded-lg text-sm font-medium transition-all {% if current_sort == 'new' %}bg-blue-600 text-white shadow-md{% else %}bg-gray-100 hover:bg-gray-200 text-gray-700{% endif %}">
                        <i class="fas fa-sparkles mr-1 hidden md:inline"></i>Нові
                    </a>
                    <a href="?sort=popular{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" 
                       class="px-3 py-1.5 rounded-lg text-sm font-medium transition-all {% if current_sort == 'popular' %}bg-blue-600 text-white shadow-md{% else %}bg-gray-100 hover:bg-gray-200 text-gray-700{% endif %}">
                        <i class="fas fa-fire mr-1 hidden md:inline"></i>Популярні
                    </a>
                    <a href="?sort=price_low{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" 
                       class="px-3 py-1.5 rounded-lg text-sm font-medium transition-all {% if current_sort == 'price_low' %}bg-blue-600 text-white shadow-md{% else %}bg-gray-100 hover:bg-gray-200 text-gray-700{% endif %}">
                        <i class="fas fa-arrow-down-wide-short mr-1 hidden md:inline"></i>Ціна ↑
                    </a>
                    <a href="?sort=price_high{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" 
                       class="px-3 py-1.5 rounded-lg text-sm font-medium transition-all {% if current_sort == 'price_high' %}bg-blue-600 text-white shadow-md{% else %}bg-gray-100 hover:bg-gray-200 text-gray-700{% endif %}">
                        <i class="fas fa-arrow-up-wide-short mr-1 hidden md:inline"></i>Ціна ↓
                    </a>
                </div>
            </div>

            <!-- Форма пошуку (десктоп версія) -->
            <div class="hidden md:block">
                {% include 'main/search_form.html' %}
            </div>
        </div>
    </div>

    <!-- Список товарів -->
    <div class="mb-12">
        {% if products %}
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                {% for product in products %}
                    {% show_product_card product %}
                {% endfor %}
            </div>
        {% else %}
            <div class="bg-white rounded-2xl shadow-sm border-2 border-dashed border-gray-300 p-12 text-center">
                <div class="text-gray-400 mb-4">
                    <i class="fas fa-box-open text-5xl"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-800 mb-2">
                    {% if search_query %}
                        Товарів за запитом "{{ search_query }}" не знайдено
                    {% else %}
                        Товарів не знайдено
                    {% endif %}
                </h3>
                <p class="text-gray-600 mb-6">
                    Спробуйте змінити критерії пошуку або переглянути інші категорії
                </p>
                <a href="{% url 'main:product_list' %}" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i>Повернутися до каталогу
                </a>
            </div>
        {% endif %}
    </div>

    <!-- Пагінація -->
    {% if products.paginator.num_pages > 1 %}
        <div class="mb-12">
            {% include 'main/pagination.html' %}
        </div>
    {% endif %}
</div>
{% endblock %}